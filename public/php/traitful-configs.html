<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<title>Traitful configs | Holger Woltersdorf&#039;s blog</title>
	<meta name="description" content="An application specifies requirements for its configuration and subdivedes them into MUST haves and COULD haves. The concept of &#039;Traitful&#039; configs shows how you can force the user of the application to implement the MUST haves and individually use the default implementations of the COULD haves.">
	<meta name="keywords" content="PHP, configuration, traits, partial implementation, defaults">
	<meta name="HandheldFriendly" content="True"/>
	<meta name="geo.region" content="DE-SN"/>
	<meta name="geo.placename" content="Dresden"/>
	<meta name="geo.position" content="51.052088;13.741672"/>
	<meta name="ICBM" content="51.052088, 13.741672"/>
	<meta name="twitter:site" content="@hollodotme">
	<meta name="twitter:creator" content="@hollodotme">
	<script type="application/ld+json">{
  "@context" : "http://schema.org",
  "@type": "Person",
  "name": "Holger Woltersdorf&#039;s blog",
  "image": "http://127.0.0.1:8081/img/Profile.png",
  "url": "http://127.0.0.1:8081",
  "sameAs" : [
      "https://twitter.com/hollodotme",
      "https://www.xing.com/profile/Holger_Woltersdorf"
    ]
  }
}</script>
	<meta property="article:author" content="https://www.xing.com/profile/Holger_Woltersdorf"/>
	<meta property="article:publisher" content="https://www.xing.com/profile/Holger_Woltersdorf"/>
	<link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png">
	<link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/favicon/apple-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="/favicon/apple-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="/favicon/apple-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-icon-180x180.png">
	<link rel="icon" type="image/png" sizes="192x192" href="/favicon/android-icon-192x192.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
	<link rel="manifest" href="/favicon/manifest.json">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="msapplication-TileImage" content="/favicon/ms-icon-144x144.png">
	<meta name="theme-color" content="#ffffff">

	<link rel="canonical" href="http://127.0.0.1:8081/php/traitful-configs.html"/>
	<meta name="referrer" content="origin"/>

	<meta property="og:site_name" content="Holger Woltersdorf&#039;s blog"/>
	<meta property="og:type" content="article"/>
	<meta property="og:title" content="Traitful configs | Holger Woltersdorf&#039;s blog"/>
	<meta property="og:description" content="An application specifies requirements for its configuration and subdivedes them into MUST haves and COULD haves. The concept of &#039;Traitful&#039; configs shows how you can force the user of the application to implement the MUST haves and individually use the default implementations of the COULD haves."/>
	<meta property="og:url" content="http://127.0.0.1:8081"/>
	<meta property="og:image" content="http://127.0.0.1:8081/img/Profile.png"/>
	<meta property="article:published_time" content="2019-05-08T22:11:19+00:00"/>
	<meta property="article:modified_time" content="2019-05-08T22:11:19+00:00"/>
			<meta property="article:tag" content="PHP"/>
			<meta property="article:tag" content="configuration"/>
			<meta property="article:tag" content="traits"/>
			<meta property="article:tag" content="partial implementation"/>
			<meta property="article:tag" content="defaults"/>
		<meta name="twitter:card" content="summary_large_image"/>
	<meta name="twitter:title" content="Traitful configs | Holger Woltersdorf&#039;s blog"/>
	<meta name="twitter:description" content="An application specifies requirements for its configuration and subdivedes them into MUST haves and COULD haves. The concept of &#039;Traitful&#039; configs shows how you can force the user of the application to implement the MUST haves and individually use the default implementations of the COULD haves."/>
	<meta name="twitter:url" content="http://127.0.0.1:8081/php/traitful-configs.html"/>
	<meta name="twitter:image:src" content="http://127.0.0.1:8081/img/Profile.png"/>

	<meta name="generator" content="IceHawk Static Page Generator"/>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">

	<link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono" rel="stylesheet">
	<link rel="stylesheet" type="text/css" media="screen" href="http://127.0.0.1:8081/css/theme.css">
	<script src="https://use.fontawesome.com/3513f09ab7.js"></script>
	</head>
<body>
<div class="themewrapper">

	<a href="#" id="sidebar-toggle"><i class="fa fa-close genericon"></i></a>

	<div id="sidebar">
		<div class="brand-well">
			<a href="http://127.0.0.1:8081">
				<img src="http://127.0.0.1:8081/img/hwoltersdorf_blue_500x500.png" alt="Holger Woltersdorf">
			</a>
		</div>

		<h3 class="text-center text-uppercase">Holger Woltersdorf</h3>
		<p class="text-center text-uppercase subline">
			CIO &middot; Developer &middot; Speaker<br>
			PHP &middot; WEB &middot; Community
		</p>

		<hr>

		<ul class="sociallinks">
			<li>
				<a href="https://twitter.com/hollodotme" title="Holger Woltersdorf on twitter (@hollodotme)" target="_blank"><i class="fa fa-twitter"></i></a>
			</li>
			<li>
				<a href="https://www.xing.com/profile/Holger_Woltersdorf" title="Holger Woltersdorf on Xing" target="_blank"><i class="fa fa-xing"></i></a>
			</li>
			<li>
				<a href="https://github.com/hollodotme" title="Holger Woltersdorf on GitHub" target="_blank"><i class="fa fa-github"></i></a>
			</li>
			<li>
				<a href="https://www.linkedin.com/in/holgerwoltersdorf" title="Holger Woltersdorf on LinkedIn" target="_blank"><i class="fa fa-linkedin"></i></a>
			</li>
		</ul>

		<hr>

		<ul class="sidebar-nav">
			<li class="hidden-sm hidden-md hidden-lg">
				<a href="http://127.0.0.1:8081/" title="Home">Home</a>
			</li>
			
						<li class="active">
		<a href="http://127.0.0.1:8081/php.html">PHP</a>
			</li>


			
						<li>
		<a href="http://127.0.0.1:8081/talks.html">Talks</a>
			</li>


			
						<li>
		<a href="http://127.0.0.1:8081/projects.html">Projects</a>
			</li>


			
						<li>
		<a href="http://127.0.0.1:8081/devops.html">DevOps</a>
			</li>


			
						<li>
		<a href="http://127.0.0.1:8081/reading-list.html">Reading list</a>
			</li>


			
						<li>
		<a href="http://127.0.0.1:8081/imprint.html">Imprint</a>
			</li>


						<li>
				<a href="https://www.papercall.io/speakers/hollodotme" target="_blank" title="My profile on papercall.io">
					PaperCall.io profile
				</a>
			</li>
			<li>
				<a href="https://speakerdeck.com/hollodotme" target="_blank" title="My profile on speakerdeck.com">
					SpeakerDeck profile
				</a>
			</li>
		</ul>

		<hr>

		<div class="text-center">
			<p>
				<small>Co-Founder of</small>
			</p>
			<a href="http://phpug-dresden.org" target="_blank">
				<img src="http://127.0.0.1:8081/img/php-usergroup-dresden.png" alt="PHP USERGROUP DRESDEN e.V." class="img img-50">
			</a>
		</div>

		<hr>

		<p class="text-center">
			<strong>Found a bug or a typo?</strong><br>
			This website is open source,<br>
			<a href="https://github.com/hollodotme/hollo.me" target="_blank" title="Website GitHub repository">please fork it and provide a PR</a>.
		</p>
		<p class="text-center website-version">
			<small>v1.2.1</small>
		</p>

	</div>

	<div id="breadcrumbs">
		<ul>
												<li>
						<a href="http://127.0.0.1:8081/index.html">
							<i class="fa fa-map-marker"></i> Home
						</a>
					</li>
																<li>
						<a href="http://127.0.0.1:8081/php.html">
							 PHP
						</a>
					</li>
																<li class="active">
						 Traitful configs
					</li>
									</ul>
	</div>

	<div id="main">

		
			<h1>Traitful configs</h1>
			<h5>An application specifies requirements for its configuration and subdivedes them into MUST haves and COULD haves. The concept of 'Traitful' configs shows how you can force the user of the application to implement the MUST haves and individually use the default implementations of the COULD haves.</h5>
			<hr>

			<h2>The problem</h2>
<p>Many PHP applications expect/require a configuration by injecting a config object.
The more complex the application is, the more extensive the need for configuration gets.</p>
<p>Every config value influences the behaviour of the application in some kind.</p>
<p>Furthermore for an easy start many applications provide a default configuration,
where only few values have to be adapted to use the application.</p>
<p>In case of object-oriented configurations there are more or less only two
possibilities to create such a configuration for the individual project:</p>
<ol>
<li>Extending a default configuration class and overwrite all the needed methods</li>
<li>Implementing the interface the application requires for configuration</li>
</ol>
<p>The first variant creates a very strong binding to the default config class
which is maybe undesirable or even not possible in some cases. </p>
<p>By publishing a configuration interface the application provides the freedom
of self-implementing a class to fulfill its configuration needs.
So why then abandon that freedom by extending a class?</p>
<p>But by using such an interface it becomes necessary to implement <strong>all</strong> of its required methods,
even though just a part of the configuration needs to be adapted. </p>
<p>To clarify this in code lets assume our application requires the following interface for its configuration:</p>
<p><strong>HINT:</strong> Code is provides in php7 syntax.</p>
<pre><code class="language-php">&lt;?php

namespace SomeCompany\Application\Interfaces;

interface ConfiguresApplication
{
    public function getName() : string;

    public function getUrl() : string;

    public function getLogger() : LogsActivity;

    public function getErrorHandler() : HandlesError; 
}</code></pre>
<p>You can see that this interface requires 2 simple string values (name and url),
alongside with 2 complex values (logger and error handler) which have required interfaces by themselves.</p>
<p>For the sake of completeness and for better comprehension of the following
code these interfaces may be defined like this:</p>
<pre><code class="language-php">&lt;?php

namespace SomeCompany\Application\Interfaces;

interface LogsActivity
{
    public function log( string $message, array $context = [ ] );
}</code></pre>
<p>and</p>
<pre><code class="language-php">&lt;?php

namespace SomeCompany\Application\Interfaces;

interface HandlesError
{
    public function handleError( \Throwable $throwable );
}</code></pre>
<hr />
<h4>Requirements</h4>
<p>The adaption of name and url are mandatory for using the application.
Configuring an own logger and/or error handler is optional and is for advanced usage.  </p>
<p>The application expects the configuration to be injected to the constructor:</p>
<pre><code class="language-php">&lt;?php

namespace SomeCompany\Application;

use SomeCompany\Application\Interfaces\ConfiguresApplication;

class Application
{
    /** @var ConfiguresApplication */
    private $config;

    public function __construct( ConfiguresApplication $config )
    {
        $this-&gt;config = $config;
    }

    /**
     * Methoden, die die Config verwenden.
     */
}</code></pre>
<hr />
<h3>1. Extending a default configuration class</h3>
<p>A default configuration class provided by the application could look like this:</p>
<pre><code class="language-php">&lt;?php

namespace SomeCompany\Application\Defaults;

use SomeCompany\Application\Interfaces\ConfiguresApplication;

class DefaultApplicationConfig implements ConfiguresApplication
{
    public function getName() : string
    {
        return 'Unnamed application';
    }

    public function getUrl() : string
    {
        return 'http://example.com';
    }

    public function getLogger() : LogsActivity
    {
        return new class implements LogsActivity
        {
            public function log( string $message, array $context )
            {
                /** I am a NullLogger, do nothing */
            }
        };
    }

    public function getErrorHandler() : HandlesError
    {
        return new class implements HandlesError
        {
            public function handleError( \Throwable $throwable )
            {
                throw $throwable;
            }
        };
    }
}</code></pre>
<p>Let's again have a look at our requirements: </p>
<ul>
<li>Name and url <strong>must</strong> be configured and</li>
<li>logger and error handler <strong>can</strong> be configured</li>
</ul>
<p>This default configuration class comes up with a problem.
It provides default values for name and url. So the user is not forced to
configure these values. Furthermore these default values have no valid use-case.</p>
<p>That means if we extend this class we have to know that the methods for
name and url must be overwritten.</p>
<p>The following configuration would be accepted by the application even
though it does not meet the requirements:</p>
<pre><code class="language-php">&lt;?php

namespace MyCompany\MyApplication\Configs;

use SomeCompany\Application\Defaults\DefaultApplicationConfig;

class MyApplicationConfig extends DefaultApplicationConfig
{

}</code></pre>
<hr />
<h3>2. Implementing the configuration interface</h3>
<p>Now let's have a look at alternatively implementing the <code>ConfiguresApplication</code> interface.
As mentioned above we are now forced to implement all of its required methods.</p>
<pre><code class="language-php">&lt;?php

namespace MyCompany\MyApplication\Configs;

use SomeCompany\Application\Interfaces\ConfiguresApplication;

class MyApplicationConfig implements ConfiguresApplication
{
    public function getName() : string
    {
        return 'My application';
    }

    public function getUrl() : string
    {
        return 'https://www.my-application.com';
    }

    public function getLogger() : LogsActivity
    {
        return new class implements LogsActivity
        {
            public function log( string $message, array $context )
            {
                /** I am a NullLogger, do nothing */
            }
        };
    }

    public function getErrorHandler() : HandlesError
    {
        return new class implements HandlesError
        {
            public function handleError( \Throwable $throwable )
            {
                throw $throwable;
            }
        };
    }
}</code></pre>
<p>This variant shows us the other side of the problem. In comparison to
extending the default configuration class we now need to impement the methods
(<code>getLogger</code> and <code>getErrorHandler</code>) that were declared optional by the requirements.</p>
<p>So how do we reach the goal to implement only what we need and use the standard parts of the configuration?</p>
<hr />
<h3>3. Providing traits</h3>
<p><a href="http://php.net/trait">In version 5.4.0 traits were introduced to PHP</a>,
which allow to embed reusable code in classes and therefor provide parts of a class.
That's exactly what we need to solve our problem.</p>
<p>Given that the application has default configurations for logging and
error handling it could provide the following traits:</p>
<pre><code class="language-php">&lt;?php

namespace SomeCompany\Application\Traits;

trait DefaultLogging
{
    public function getLogger() : LogsActivity
    {
        return new class implements LogsActivity
        {
            public function log( string $message, array $context )
            {
                /** I am a NullLogger, do nothing */
            }
        };
    }
}</code></pre>
<p>and</p>
<pre><code class="language-php">&lt;?php

namespace SomeCompany\Application\Traits;

trait DefaultErrorHandling
{
    public function getErrorHandler() : HandlesError
    {
        return new class implements HandlesError
        {
            public function handleError( \Throwable $throwable )
            {
                throw $throwable;
            }
        };
    }
}</code></pre>
<p>The default configuration class <code>DefaultApplicationConfig</code> mentioned above is
no longer provided by the application. Instead it only provides the <code>ConfiguresApplication</code>
interface and the two traits <code>DefaultLogging</code> and <code>DefaultErrorHandling</code>.</p>
<p>Now we are able to combine the must have configuration of values with
default configurations in one implementation of the config interface that meets perfectly the requirements.</p>
<hr />
<h3>4. Result: A &quot;Traitful&quot; config</h3>
<p>The most simple configuration would look like this:</p>
<pre><code class="language-php">&lt;?php

namespace MyCompany\MyApplication\Configs;

use SomeCompany\Application\Interfaces\ConfiguresApplication;
use SomeCompany\Application\Traits\DefaultErrorHandling;
use SomeCompany\Application\Traits\DefaultLogging;

class MyApplicationConfig implements ConfiguresApplication
{
    public function getName() : string
    {
        return 'My application';
    }

    public function getUrl() : string
    {
        return 'https://www.my-application.com';
    }

    use DefaultLogging;
    use DefaultErrorHandling;
}</code></pre>
<p>As you can see we used a specific naming schema for our interfaces, traits and classes
which clarifies the kind of each used element. This improves the comprehensibility of our application components
and makes the code more readable.</p>
<h3>Overview naming schema</h3>
<p><strong>Interfaces:</strong></p>
<ul>
<li>ConfiguresApplication</li>
<li>LogsActivity</li>
<li>HandlesError</li>
</ul>
<p><strong>Traits:</strong></p>
<ul>
<li>DefaultLogging</li>
<li>DefaultErrorHandling</li>
</ul>
<p><strong>Classes:</strong></p>
<ul>
<li>ApplicationConfig</li>
<li>Logger</li>
<li>ErrorHandler</li>
</ul>
<h3>Project structure</h3>
<p>A typical project structure based on <a href="https://getcomposer.org">composer</a>
and <a href="http://www.php-fig.org/psr/psr-0/">PSR-0</a> could look as follows.</p>
<pre><code class="language-bash">- MyApplication
  |- ...
  |- src
  |  `- Configs
  |     `- MyApplicationConfig.php
  |- ...
  `- vendor
     `- SomeCompany
        `- Application
           |- Traits
           |  |- DefaultErrorHandler.php
           |  `- DefaultLogging.php
           |- Interfaces
           |  |- ConfiguresApplication.php
           |  |- HandlesError.php
           |  `- LogsActivity.php
           `- Application.php</code></pre>
<hr />
<p>You can find the complete example code under:</p>
<div class="github-card" data-user="hollodotme" data-repo="traitful-configs" data-width="100%"></div>
<script src="//cdn.jsdelivr.net/github-cards/latest/widget.js"></script>
<hr />
<p>Related links / References:</p>
<ul>
<li><a href="http://php.net/trait">PHP Traits</a></li>
<li><a href="https://getcomposer.org">composer - php dependency manager</a></li>
<li><a href="http://www.php-fig.org/psr/psr-0/">Namespace Standard PSR-0</a></li>
<li><i class="fa fa-github"></i> <a href="https://github.com/hollodotme/traitful-configs">hollodotme/traitful-configs</a></li>
</ul>
<p><small>03/12/2016</small></p>

		
	</div>
</div>
<script src="http://127.0.0.1:8081/js/theme.js"></script>
<script src="http://127.0.0.1:8081/js/prism.js"></script>
<link rel="stylesheet" href="http://127.0.0.1:8081/css/prism.css">
</body>
</html>
